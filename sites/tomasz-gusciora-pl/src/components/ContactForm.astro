---
/**
 * ContactForm - Primary CTA for training inquiries
 *
 * Features:
 * - Formspark integration
 * - Honeypot spam protection (hidden field)
 * - Client-side validation
 * - Success/error feedback
 * - PL/EN locale support
 */

interface Props {
  locale: 'pl' | 'en';
}

const { locale } = Astro.props;

const content = {
  pl: {
    title: 'Skontaktuj się',
    subtitle: 'Masz pytania o szkolenie? Napisz do mnie.',
    namePlaceholder: 'Twoje imię',
    emailPlaceholder: 'Twój email',
    messagePlaceholder: 'O czym chciałbyś porozmawiać?',
    submit: 'Wyślij wiadomość',
    sending: 'Wysyłanie...',
    success: 'Dziękuję! Odpowiem najszybciej jak to możliwe.',
    error: 'Coś poszło nie tak. Spróbuj ponownie lub napisz bezpośrednio na tomasz@demystifai.blog',
    required: 'To pole jest wymagane',
    invalidEmail: 'Podaj prawidłowy adres email',
  },
  en: {
    title: 'Get in Touch',
    subtitle: 'Questions about the training? Send me a message.',
    namePlaceholder: 'Your name',
    emailPlaceholder: 'Your email',
    messagePlaceholder: 'What would you like to discuss?',
    submit: 'Send Message',
    sending: 'Sending...',
    success: 'Thank you! I\'ll respond as soon as possible.',
    error: 'Something went wrong. Please try again or email tomasz@demystifai.blog directly.',
    required: 'This field is required',
    invalidEmail: 'Please enter a valid email address',
  },
};

const t = content[locale];

// Formspark form ID - to be configured
const FORMSPARK_FORM_ID = 'REPLACE_WITH_FORMSPARK_ID';
---

<section class="contact" id="contact">
  <div class="container contact-container">
    <div class="contact-header">
      <h2 class="contact-title">{t.title}</h2>
      <p class="contact-subtitle">{t.subtitle}</p>
    </div>

    <form
      class="contact-form"
      action={`https://submit-form.com/${FORMSPARK_FORM_ID}`}
      method="POST"
      data-success={t.success}
      data-error={t.error}
      data-sending={t.sending}
      data-submit={t.submit}
    >
      <!-- Honeypot field for spam protection -->
      <input type="text" name="_honeypot" class="honeypot" tabindex="-1" autocomplete="off" />

      <!-- Hidden field for redirect (Formspark) -->
      <input type="hidden" name="_redirect" value="false" />

      <div class="form-group">
        <label for="name" class="form-label">{t.namePlaceholder}</label>
        <input
          type="text"
          id="name"
          name="name"
          class="form-input"
          placeholder={t.namePlaceholder}
          required
          autocomplete="name"
        />
      </div>

      <div class="form-group">
        <label for="email" class="form-label">{t.emailPlaceholder}</label>
        <input
          type="email"
          id="email"
          name="email"
          class="form-input"
          placeholder={t.emailPlaceholder}
          required
          autocomplete="email"
        />
      </div>

      <div class="form-group">
        <label for="message" class="form-label">{t.messagePlaceholder}</label>
        <textarea
          id="message"
          name="message"
          class="form-input form-textarea"
          placeholder={t.messagePlaceholder}
          rows="5"
          required
        ></textarea>
      </div>

      <button type="submit" class="btn btn-primary form-submit">
        {t.submit}
      </button>

      <div class="form-status" aria-live="polite"></div>
    </form>
  </div>
</section>

<style>
  .contact {
    padding: var(--spacing-3xl) 0;
    background: var(--color-bg);
  }

  .contact-container {
    max-width: 600px;
  }

  .contact-header {
    text-align: center;
    margin-bottom: var(--spacing-2xl);
  }

  .contact-title {
    font-size: var(--text-3xl);
    margin-bottom: var(--spacing-sm);
    color: var(--color-text);
  }

  .contact-subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  /* Honeypot - hidden from real users */
  .honeypot {
    position: absolute;
    left: -9999px;
    top: -9999px;
    opacity: 0;
    pointer-events: none;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .form-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
  }

  .form-input {
    padding: var(--spacing-md);
    font-size: var(--text-base);
    font-family: var(--font-sans);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-bg);
    color: var(--color-text);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  }

  .form-input:hover {
    border-color: var(--color-border-hover);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
  }

  .form-input::placeholder {
    color: var(--color-text-muted);
  }

  .form-textarea {
    resize: vertical;
    min-height: 120px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-md) var(--spacing-xl);
    font-size: var(--text-base);
    font-weight: 600;
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
    cursor: pointer;
    border: none;
  }

  .btn-primary {
    background: var(--color-primary);
    color: var(--color-primary-text);
  }

  .btn-primary:hover:not(:disabled) {
    background: var(--color-primary-hover);
  }

  .btn-primary:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .form-submit {
    align-self: flex-start;
  }

  .form-status {
    text-align: center;
    font-size: var(--text-base);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    display: none;
  }

  .form-status.success {
    display: block;
    background: rgba(5, 150, 105, 0.1);
    color: var(--color-success);
    border: 1px solid var(--color-success);
  }

  .form-status.error {
    display: block;
    background: rgba(220, 38, 38, 0.1);
    color: var(--color-error);
    border: 1px solid var(--color-error);
  }

  @media (max-width: 640px) {
    .contact {
      padding: var(--spacing-2xl) 0;
    }

    .contact-title {
      font-size: var(--text-2xl);
    }

    .form-submit {
      width: 100%;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const forms = document.querySelectorAll<HTMLFormElement>('.contact-form');

    forms.forEach((form) => {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = form.querySelector<HTMLButtonElement>('.form-submit');
        const statusEl = form.querySelector<HTMLElement>('.form-status');

        if (!submitBtn || !statusEl) return;

        const successMsg = form.dataset.success || 'Success!';
        const errorMsg = form.dataset.error || 'Error. Please try again.';
        const sendingMsg = form.dataset.sending || 'Sending...';
        const submitMsg = form.dataset.submit || 'Send';

        // Disable button and show sending state
        submitBtn.disabled = true;
        submitBtn.textContent = sendingMsg;
        statusEl.className = 'form-status';
        statusEl.textContent = '';

        try {
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              Accept: 'application/json',
            },
          });

          if (response.ok) {
            statusEl.className = 'form-status success';
            statusEl.textContent = successMsg;
            form.reset();
          } else {
            throw new Error('Form submission failed');
          }
        } catch {
          statusEl.className = 'form-status error';
          statusEl.textContent = errorMsg;
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = submitMsg;
        }
      });
    });
  });
</script>
